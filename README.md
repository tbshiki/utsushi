# utsushi - テキスト差分比較ツール

> 複数テキストをブラウザ内で比較。完全ローカル処理でプライバシー保護。

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## 概要

**utsushi** は、複数のテキストをブラウザ内で比較できるツールです。すべての処理はローカルで行われ、入力内容がサーバーに送信されることはありません。

## 特徴

- 🔒 **完全ローカル処理** - データは一切外部に送信されません
- 📝 **最大4テキスト比較** - イ・ロ・ハ・ニの4パネル対応
- ➕ **動的パネル追加** - 必要に応じてパネルを追加・削除
- 🎯 **単語レベル差分** - 変更された単語を濃い色でハイライト
- 🎨 **ダーク/ライトモード** - システム設定に連動、手動切り替え可能
- 📊 **リアルタイム統計** - 文字数・単語数・行数をリアルタイム表示
- 📱 **レスポンシブ対応** - PC・タブレット・スマートフォンで利用可能

## 使い方

### 基本操作

1. **イ** に基準となるテキストを入力
2. **ロ** に比較したいテキストを入力
3. 「差分を比較」ボタンをクリック
4. 差分がハイライト表示されます

### パネル追加

1. 「+ パネル追加」ボタンをクリック
2. **ハ** や **ニ** のパネルが追加されます
3. 追加したパネルは🗑アイコンで削除可能

### テーマ切り替え

ヘッダー右上のボタンでテーマを切り替えられます：
- ☀️ **ライトモード**
- 🌙 **ダークモード**

初回アクセス時はシステム設定（OS設定）に従います。

### テキスト統計

各パネルのフッターにリアルタイムで表示：
- **文字数** - 改行を除いた文字数
- **単語数** - 英単語 + 日本語文字 + 数字
- **行数** - 改行で区切られた行数

### 比較結果

入力されたすべてのテキストの組み合わせが比較されます：
- イ vs ロ
- イ vs ハ（ハがある場合）
- ロ vs ハ（ハがある場合）
- など

## 色分け

| 色 | 意味 |
|----|------|
| 🟢 緑 | 追加された行・単語 |
| 🔴 赤 | 削除された行・単語 |
| 🟡 黄 | 変更された行（単語レベルで差分表示） |

## 技術仕様

### 使用技術

| 項目 | 技術 |
|------|------|
| 言語 | JavaScript (ES6+) |
| 差分ライブラリ | [jsdiff](https://github.com/kpdecker/jsdiff) v5.1.0 |
| フォント | Noto Sans JP, JetBrains Mono |
| 多言語対応 | 日本語 / English |
| セキュリティ | CSP (Content Security Policy) |

### ファイル構成

```
utsushi/
├── index.html      # メインHTML
├── style.css       # スタイルシート
├── main.js         # エントリーポイント
├── diff-engine.js  # 差分計算エンジン
├── ui.js           # UI制御・テーマ・動的パネル管理
├── i18n.js         # 多言語対応モジュール
├── locales/        # 翻訳ファイル
│   ├── ja.json     # 日本語
│   └── en.json     # English
├── scripts/        # ビルドスクリプト
│   ├── build.js     # dist生成
│   └── inject-analytics.js  # アナリティクス挿入
├── dist/           # ビルド出力（配信対象）
├── README.md       # このファイル
└── DEPLOY.md       # デプロイ手順
```

### セキュリティ

| 項目 | 設定 |
|------|------|
| CSP | Content Security Policy 適用 |
| SRI | CDNスクリプトに Subresource Integrity を適用 |
| Cookie | アナリティクスのみ（オプション） |
| LocalStorage | テーマ設定・言語設定を保存 |
| テキストデータ | 外部送信なし（完全ローカル処理） |

## ローカル開発

```bash
# リポジトリをクローン
git clone https://github.com/tbshiki/utsushi.git
cd utsushi

# ローカルサーバーを起動
npx serve .

# または
npx http-server .
```

ブラウザで http://localhost:3000 にアクセス

## ビルド（配信用）

不要ファイルを配信対象から除外するため、ビルドで `dist/` を作成します。

```bash
# dist/ を生成
node scripts/build.js

# dist/ を確認
npx serve dist
```

## デプロイ

デプロイ手順は [DEPLOY.md](DEPLOY.md) を参照してください。

## プライバシーについて

- ✅ 本ツールはすべてローカル処理です
- ✅ 入力内容はサーバーに送信されません
- ⚠️ 入力データの責任は利用者にあります

## ライセンス

MIT License

Copyright (c) 2026 tbshiki

## バージョン履歴

### v0.2.3 (2026-01-23)
- 日本語を含む単語分割の精度改善（Intl.Segmenter 対応）
- CSP をハードニング（base-uri/object-src/frame-ancestors/form-action 追加）
- DOM生成を安全なAPIに変更（XSS耐性向上）
- フッターに著作情報とリポジトリリンクを追加

### v0.2.2 (2026-01-23)
- 配信用ビルド（dist出力）を追加
- アナリティクス挿入をdistに適用

### v0.2.1 (2026-01-23)
- 入力パネルの4枚時は2x2レイアウト、スマホは1列に最適化
- 手動のtabindex制御を廃止し、自然なフォーカス順に統一
- CDN差分ライブラリにSRIを追加

### v0.2.0 (2026-01-22)
- ダーク/ライトモード切り替え機能追加
- システム設定に連動するテーマ初期化
- テキスト統計（文字数・単語数・行数）のリアルタイム表示
- エラー表示をトースト通知に改善
- 同期スクロールの改善（水平スクロール対応）
- バグ修正・リファクタリング

### v0.1.0 (2026-01-22)
- 初回リリース
- イロハニ名称でのパネル表示
- 動的パネル追加・削除機能
- 単語レベル差分ハイライト
- 全組み合わせ差分比較
- CSPによる完全ローカル処理

---

Made with ❤️ for better text comparison
